<%= render 'layouts/navbar' %>


<% if user_signed_in? %>      <!-- controllo utente autenticato, scritte opzionali -->
<% else %>
    <h1>NON SEI REGISTRATO! DEVI REGISTRARTI</h1>  <!-- blurra tutto e fai apparire il login form? -->
<% end %>   

<!-- TITOLO -->
<h1 class="forum-title">Guardaloo's Forum</h1>

<!-- NUOVO POST + FILTRI -->
<div class="filters-container" id="filters-container">
  <div class="new-post-button">
    <%= link_to 'Scrivi un nuovo Post', new_post_path, class: "btn forum-button2" %>
  </div>

  <%= form_with url: posts_path, method: :get, local: true, html: { class: "filter-form" } do %>
    <div class="filters">
      <%= label_tag :query, "", class:"post-content"%>
      <%= text_field_tag :query, params[:query], placeholder: "Cerca i post", class:"forum-search-filters px-2 align-items-center", style:"border-radius:0.6em; height:2.1em; font-size:1.2em;", autocomplete: "off"%>

      <%= select_tag :filter, options_for_select([
          ['Tutti i post', 'all'],
          ['Solo i miei post', 'my_posts']
        ], selected: params[:filter]), include_blank: false, class:"forum-search-filters", style:"border-radius:0.6em; height:2.1em; font-size:1.2em; width:20em;"%>

      <%= submit_tag "Filtra", class: "btn forum-button2" %>
    </div>
  <% end %>
</div>

<!-- POST -->
<div class="posts-container">
  <% if @posts.any? %>
  <% @posts.each do |post| %>
    <div class="post-card">      

      <div class="post-title">
        <h2 ><%= link_to post.title, post %></h2> 
          Creato da <%= post.user.username %>
      </div>
      <div class="post-content">
        <p style="margin-left: 3em; padding-right: 8em; text-align:justify"><%= post.content %></p>
      </div>
      <p class="post-content">
        <%= post.comments.count %> 
        <%= post.comments.count == 1 ? 'commento' : 'commenti' %>
      </p>

      <div class="post-actions">
        <% if user_signed_in? && current_user == post.user %>
        <%= link_to 'Modifica', edit_post_path(post), class: 'btn btn-edit' %>
        <%= button_to 'Elimina', post_path(post), method: :delete, data: { confirm: 'Sei sicuro?', turbo: false }, class: 'btn btn-delete' %>
        <% end %>
      </div>
    </div>

    <% end %>
  <% else %>
    <p class="post-title">Non ci sono risultati per la tua ricerca.</p>
    <% end %>
</div>



<%= render 'layouts/footer' %>