<!-- Navbar -->
<%= render 'layouts/navbar' %>

<div class="posts-container">
  <%= link_to 'Ritorna al Forum', posts_path, class:"btn forum-button2 mobile", style:"position:absolute; left:3em;" %>
  <div class="new-post-form-container-show">
    <%# immagine di sinistra %>
    <%= image_tag "https://image.tmdb.org/t/p/w342#{@post.movie_poster_path}", style:"overflow: hidden; border-radius:0.5em; height:100%;", class:"immagine" %>
     
    <%# dettagli post e contenuto %>
    <div class="post-card2"  style="height: 100%; min-height:24em">
      <div class="foto-titolo-creatore" id="foto-titolo-creatore" style="" >
        <div class="avatar-container">  <%# avatar %>
          <% if @post.user.avatar_filename? %>
            <%= image_tag "/uploads/avatars/#{@post.user.avatar_filename}", class: "post-avatar" %>
          <% else %>
            <%= image_tag "Profile_page/default_avatar.svg", alt: "Immagine di default", class: "post-avatar" %>
          <% end %>
          <p class="post-title" style="font-size: 1.2em;">Creato <%= time_ago_in_words(@post.created_at) %> fa da <%= @post.user.username%> 
        </div>
    
        <%# titolo post e info %>
        <div class="post-title" style="margin-top:1em; width:95%; margin-left:auto; margin-right:1em; border-radius:0.5em;">
          <h1><%= @post.title %></h1>
          <span><a href="/movies/<%= @post.movie_id %>" style="color: #FD7474;"><%= @post.movie_title %></a></span></p>
        </div>
      </div>
      
      <%# contenuto post %>
      <div class="post-content" style="margin-top: 0.7em;">
        <h4><%= @post.content %></h4>
      </div>
    </div>
  </div>
</div>

<%# commenti %>
<div class="posts-container">
  <div class="filters-container">
    <h2 class="comment-title">Commenti</h1> 

    <%# modifica post %>
    <div style="flex-shrink:0;" class="modifica-commenta">
      <button class="btn"> <%= link_to 'Modifica il post', edit_post_path(@post), style:"text-decoration:none;", class:"btn forum-button2"%> </button>
      <% if user_signed_in? %>
        <button id="show-new-comment-form", class="btn forum-button2" style="margin-left: 0.5em;"> Commenta il Post</button>
      <% end %>
    </div>
  </div>

  <%# crea commento %>
  <div id="new-comment-form" style="display:none;">
      <div class="new-post-card new-comment">
        <%= render 'comments/form', post: @post %> 
      </div>
  </div>
  <%# commenti %>
  <div id="comments" class="posts-container">
  <% valid_comments = @post.comments.select { |c| c.content.present? } %>
  <% if valid_comments.empty? %>
    <div class="post-card2">
      <p class="post-content" style="margin: 1em 3em;">Non ci sono ancora commenti sotto questo post</p>
    </div>
  <% else %>
    <%= render valid_comments %>
  <% end %>
</div>

</div> 



<!-- Footer -->
<%= render 'layouts/footer' %>