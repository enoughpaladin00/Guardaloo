<!--Navbar-->

<%= render 'layouts/navbar' %>


<h1>Lista Cinema Vicini</h1>

<div id="cinema-list">
  <p>Caricamento in corso...</p>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        const response = await fetch(`/cinemas.json?lat=${lat}&lon=${lon}`);
        const cinemas = await response.json();

        const listContainer = document.getElementById("cinema-list");
        listContainer.innerHTML = "";

        if (cinemas.length === 0) {
          listContainer.innerHTML = "<p>Nessun cinema trovato nelle vicinanze.</p>";
          return;
        }

        cinemas.forEach(cinema => {
          const div = document.createElement("div");
          div.classList.add("cinema");

          const map = cinema.address
            ? `<iframe width="300" height="200" frameborder="0" style="border:0"
                 src="https://maps.google.com/maps?q=${encodeURIComponent(cinema.address)}&output=embed"
                 allowfullscreen></iframe>`
            : "";

          div.innerHTML = `
            <h2>${cinema.name} (${cinema.distance ?? "?"} km)</h2>
            <p>${cinema.address || 'Indirizzo non disponibile'}, ${cinema.town || '-'} (${cinema.province || '-'})</p>
            <p>Telefono: ${cinema.phone || 'N/A'}</p>
            ${map}
          `;

          listContainer.appendChild(div);
        });
      });
    } else {
      document.getElementById("cinema-list").innerHTML = "<p>Geolocalizzazione non supportata dal browser.</p>";
    }
  });
</script>
