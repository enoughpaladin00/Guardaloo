<div id="comment-<%= comment.id %>" class="comment-card">
  <div class="comment-header">
    <% if comment.user.avatar_filename? %>
      <%= image_tag "/uploads/avatars/#{comment.user.avatar_filename}", class: "comment-avatar" %>
    <% else %>
      <%= image_tag "Profile_page/default_avatar.svg", alt: "Immagine di default", class: "comment-avatar" %>
    <% end %>


    <div class="comment-info">
      <p class="comment-meta">
        <strong><%= comment.user.username %></strong>
        Â· <%= time_ago_in_words(comment.created_at) %> fa
      </p>
    </div>

  <%# DEBUG: stampa info in HTML %>
  <%# <div style="font-size: 0.7em; color: red;"> %>
    <%# current_user: <%= current_user&.id %><br>
    <%# comment.user.id: <%= comment.user.id %><br>
    <%# post owner id: <%= comment.post.user.id %> 
  <%# </div> %>


    <% if user_signed_in? && (current_user == comment.user || current_user == comment.post.user || current_user.admin? || current_user.moderator?) %>
      <div class="comment-actions">
        <button class="btn forum-button2 edit-comment-button"
          data-comment-id="<%= comment.id %>"
          data-comment-content="<%= j comment.content %>">
          Modifica
        </button>
        <%= button_to 'Elimina', [comment.post, comment], method: :delete, data: { confirm: 'Sei sicuro?' }, class: "btn forum-button2 delete-comment-btn", style:"background-color: #004466;" %>
      </div>
    <% end %>
  </div>

  <div class="comment-body">
    <p><%= comment.content %></p>
  </div>

  <script>
  document.addEventListener("turbo:load", function () {
    if (window.innerWidth <= 768) {
      document.querySelectorAll(".comment-meta").forEach(el => {
        const regex = /meno di un minuto fa/;
        if (regex.test(el.textContent)) {
          el.innerHTML = el.innerHTML.replace(regex, "&lt; un minuto fa");
        }
      });
    }
  });

</script>

</div>
