<div id="comment-<%= comment.id %>" class="comment-card">
  <div class="comment-header">
    <%= image_tag(
      comment.user.avatar.attached? ? url_for(comment.user.avatar) + "?#{comment.user.avatar.blob.created_at.to_i}" : asset_path('Profile_page/default_avatar.svg'),
      class: "comment-avatar",
      alt: "Avatar",
      onerror: "this.onerror=null; this.src='#{asset_path('Profile_page/default_avatar.svg')}';"
    ) %>


    <div class="comment-info">
      <p class="comment-meta">
        <strong><%= comment.user.username %></strong>
        Â· <%= time_ago_in_words(comment.created_at) %> fa
      </p>
    </div>

    <% if comment.user == current_user %>
      <div class="comment-actions">
        <%= button_to 'Elimina', [comment.post, comment], method: :delete, data: { confirm: 'Sei sicuro?' }, class: "btn forum-button2 delete-comment-btn" %>
        <button class="btn forum-button2 edit-comment-button"
          data-comment-id="<%= comment.id %>"
          data-comment-content="<%= j comment.content %>">
          Modifica il commento
        </button>
      </div>
    <% end %>
  </div>

  <div class="comment-body">
    <p><%= comment.content %></p>
  </div>

  <script>
  document.addEventListener("turbo:load", function () {
    const buttons = document.querySelectorAll(".edit-comment-button");

    function updateButtonLabels() {
      buttons.forEach(button => {
        if (window.innerWidth <= 768) {
          button.textContent = "Modifica";
        } else {
          button.textContent = "Modifica il commento";
        }
      });
    }

    updateButtonLabels();
    window.addEventListener("resize", updateButtonLabels);
  });

  document.addEventListener("turbo:load", function () {
    if (window.innerWidth <= 768) {
      document.querySelectorAll(".comment-meta").forEach(el => {
        const regex = /meno di un minuto fa/;
        if (regex.test(el.textContent)) {
          el.innerHTML = el.innerHTML.replace(regex, "&lt; un minuto fa");
        }
      });
    }
  });

</script>

</div>
