<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>

<body>
    <div class="body-background">
    <%= render 'layouts/navbar' %>

    <!-- User_page -->
    <div class="User_Page">

        <div class="User_half">
            <!-- information about user -->
            <div class="Sezione_1">

                <!-- user bio -->
                <div class="user_info">
                    <!--User avatar -->
                    <div class="user_img">
                        <% if @user.persisted? && @user.avatar.attached? %>
                            <%= image_tag url_for(@user.avatar) + "?#{@user.avatar.blob.created_at.to_i}", alt: "Avatar", class: "Avatar", width: 200 %>
                        <% else %>
                            <%= image_tag "Profile_page/default_avatar.svg", alt: "Immagine di default", width: 200, class: "Avatar" %>
                        <% end %>
                    </div>

                    <div class="user_name">
                        <h2> <%= current_user.username%> </h2>
                    </div>
                    
                    <div class="user_edit">
                        <button class="yellow-button button-1 edit-button"> Edit profile </button>
                    </div>
                </div>

                <hr style="margin-right: 2%">

                <!-- user stats -->
                <div class="user_stat">
                    <a>Film Visti</a>
                    <br>
                    <a>Recensioni Scritte</a>
                    <br>
                    <a>Cinema Salvati</a>
                </div>

            </div>
            <!-- top 3 film  -->
            <div class="Sezione_2">

                <div class=Sezione_2-1>
                    <h2>TOP Film della settimana</h2>
                </div>
                <div class="Sezione_2-2"> <!-- o altezza adatta -->
                    <% @trending_movies.each_with_index do |movie, index| %>
                        <% if movie['poster_path'].present? %>
                            <%= image_tag "https://image.tmdb.org/t/p/w500#{movie['poster_path']}", class: "Locandina Film#{index + 1}", alt: movie['title'] %>
                        <% else %>
                            <%= image_tag "Profile_page/film_default.png", class: "Locandina Film#{index + 1}", alt: "Immagine di default" %>
                        <% end %>
                    <% end %>
              </div>

            </div>
        </div>
        <div class="Sezione_3">
            <h1>sezione recensioni</h1>
        </div>
    </div>

    <!-- PopUp Edit -->
    <div id="edit-popup-overlay" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="auth-box">
                <div>
                    <span class="popup-txt" style="color: var(--color-2)">Modifica il tuo profilo</span>
                </div>
                <br>
                <div>
                    <%= form_with model: @user, url: profile_path, method: :patch, local: true, html: { multipart: true } do |f| %>
                        <div>
                            <%= f.label :first_name, "Nome", style:"color: var(--color-3)" %><br>
                            <%= f.text_field :first_name, required: true, class: "form-control mb-3", style:"color: var(--color-3)" %>
                        </div>
                        <div>
                            <%= f.label :last_name, "Cognome", style:"color: var(--color-3)" %><br>
                            <%= f.text_field :last_name, required: true, class: "form-control mb-3", style:"color: var(--color-3)"%>
                        </div>
                        <div>
                            <%= f.label :birth_date, "Data di nascita", style:"color: var(--color-3)" %><br>
                            <%= f.date_field :birth_date, required: true, class: "form-control mb-3", style:"color: var(--color-3)" %>
                        </div>
                        <div>
                            <%= f.label :username, "Username", style:"color: var(--color-3)" %><br>
                            <%= f.text_field :username, required: true, class: "form-control mb-3", style:"color: var(--color-3)" %>
                        </div>
                        <div>
                            <%= f.label :email, "Email", style:"color: var(--color-3)" %><br>
                            <%= f.email_field :email, required: true, class: "form-control mb-3", style:"color: var(--color-3)" %>
                        </div>
                        <div>
                            <%= f.label :avatar, "Immagine del profilo", style:"color: var(--color-3)" %><br>
                            <%= f.file_field :avatar, class: "form-control mb-3", style:"color: var(--color-3)" %>
                        </div>
                        <div>
                            <%= label_tag :current_password, "Password attuale", style:"color: var(--color-3)" %><br>
                            <%= password_field_tag :current_password, nil, required: true, class: "form-control" %>
                        </div>

                        <div>
                            <br>
                            <%= f.submit "Salva modifiche", class:"close-popup yellow-button button-1 sumbit-button" %>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        document.querySelector(".edit-button").addEventListener("click", function() {
            document.getElementById("edit-popup-overlay").style.display = "flex";
        });

        document.getElementById("close-popup").addEventListener("click", function() {
            document.getElementById("edit-popup-overlay").style.display = "none";
        });
    </script> 

</body>
