<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>

<body>
    <div class="body-background">
    <%= render 'layouts/navbar' %>

    <!-- User_page -->
    <div class="User_Page">

        <div class="User_half">
            <!-- information about user -->
            <div class="Sezione_1">

                <!-- user bio -->
                <div class="user_info">
                    <!--User avatar -->
                    <div class="user_img">
                        <% if @user.persisted? && @user.avatar.attached? %>
                            <%= image_tag url_for(@user.avatar) + "?#{@user.avatar.blob.created_at.to_i}", alt: "Avatar", class: "Avatar", width: 200 %>
                        <% else %>
                            <%= image_tag "Profile_page/default_avatar.svg", alt: "Immagine di default", width: 200, class: "Avatar" %>
                        <% end %>
                    </div>

                    <div class="user_name">
                        <h2> <%= current_user.username%> </h2>
                    </div>
                    
                    <div class="user_edit">
                        <button class="yellow-button button-1 edit-button"> Edit profile </button>
                    </div>
                </div>

                <hr style="margin-right: 2%, color: var(--color-4)">

                <!-- user stats -->
                <div class="post_created">
                    <div class="container-fluid d-flex align-items-center">
                        <h1 class="px-2 py-2 mb-0 titolo"><b>Forum</b></h1>
                        <%= image_tag "homepage/forum.svg", class: "icon" %>
                    </div>
            
                    <div align="center">
                        <a href="#" class="link-underline link-underline-opacity-0">
                        <div class="forum-item">
                            <div class="forum-title-homepage" style="color: #004466; text-align: left;">Best Movie 2024</div>
                                <div class="forum-meta mb-1 text-muted">
                                    <span>MovieBuff</span>
                                    <span>45 replies</span>
                                </div>
                            </div>
                        </a>
                        </div>
            
                    <div align="center">
                        <a href="#">
                        <button class="forum-button">Vedi tutti</button>
                        </a>
                    </div>
            
                </div>

            </div>

            
            <!-- top 3 film  -->
            <div class="Sezione_2">

                <div class=Sezione_2-1>
                    <h2>Film Preferiti</h2>
                    <button class="yellow-button button-1 favourite-button"> Change Favourite </button>
                </div>
                <div class="Sezione_2-2">
                    <% @chosen_movies.each_with_index do |movie, index| %>
                        <% if movie && movie['poster_path'].present? %>
                            <%= image_tag "https://image.tmdb.org/t/p/w500#{movie['poster_path']}", class: "Locandina Film#{index + 1} movie-poster", alt: movie['title'], data: { index: index } %>
                        <% else %>
                            <%= image_tag "Profile_page/film_default.png", class: "Locandina Film#{index + 1} default-poster", alt: "Immagine di default", data: { index: index } %>
                        <% end %>
                    <% end %>
                </div>

            </div>
        </div>
        
        <!-- Carosello Film Preferiti -->
        <div class="Sezione_3">
            <div class="box_3-1">
                <h1 class="titolo_3"><b>La Mia Lista Preferiti</b></h1>
            </div>
            <br>
            <div class="slider-preferiti">
                <button class="slider-btn left"><%= image_tag "homepage/freccia.svg", class: "slider_img", style: "transform: rotate(180deg)" %></button>
                <div class="box_3-2">
                    <div class="slider-track">
                        <% @preferiti.each do |movie| %>
                
                            <div class="contenitore contenitore-film">
                                <a href="/movies/<%= movie['id'] %>"><img class="locandina" src="https://image.tmdb.org/t/p/w500<%= movie['poster_path'] %>" alt="<%= movie['title'] %>" ></a>
                            </div>
        
                        <%end%>
                    </div>
                </div>
                <button class="slider-btn right"><%= image_tag "homepage/freccia.svg", class: "slider_img" %></button>
            </div>  
            <br>
            <div class="box_3-3">
                
            </div>        
        </div>
    
    </div>

    <!-- PopUp Edit -->
    <div id="edit-popup-overlay" class="edit-overlay" style="display: none;">
        <div class="popup-content">
            <div class="edit-box">
                <div>
                    <span class="popup-txt" style="color: var(--color-1)">Modifica il tuo profilo</span>
                </div>
                <br>
                <div>
                    <%= form_with model: @user, url: profile_path, method: :patch, local: true, html: { multipart: true } do |f| %>
                        <div>
                            <%= f.label :first_name, "Nome", style:"color: var(--color-1)" %><br>
                            <%= f.text_field :first_name, required: true, class: "form-control mb-3", style:"color: var(--color-1)" %>
                        </div>
                        <div>
                            <%= f.label :last_name, "Cognome", style:"color: var(--color-1)" %><br>
                            <%= f.text_field :last_name, required: true, class: "form-control mb-3", style:"color: var(--color-1)"%>
                        </div>
                        <div>
                            <%= f.label :birth_date, "Data di nascita", style:"color: var(--color-1)" %><br>
                            <%= f.date_field :birth_date, required: true, class: "form-control mb-3", style:"color: var(--color-1)" %>
                        </div>
                        <div>
                            <%= f.label :username, "Username", style:"color: var(--color-1)" %><br>
                            <%= f.text_field :username, required: true, class: "form-control mb-3", style:"color: var(--color-1)" %>
                        </div>
                        <div>
                            <%= f.label :email, "Email", style:"color: var(--color-1)" %><br>
                            <%= f.email_field :email, required: true, class: "form-control mb-3", style:"color: var(--color-1)" %>
                        </div>
                        <div>
                            <%= f.label :avatar, "Immagine del profilo", style:"color: var(--color-1)" %><br>
                            <%= f.file_field :avatar, class: "form-control mb-3", style:"color: var(--color-1)" %>
                        </div>
                        <div>
                            <%= label_tag :current_password, "Password attuale", style:"color: var(--color-1)" %><br>
                            <%= password_field_tag :current_password, nil, required: true, class: "form-control" %>
                        </div>

                        <div>
                            <br>
                            <%= f.submit "Salva modifiche", class:"close-popup yellow-button button-1 sumbit-button" %>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
    </div>

    <!-- Pop Up favourite Movies -->
    <div id="favourite-popup-overlay" class="preferiti-overlay" style="display: none;">
        <div class="fav-box">
            <div>
                <span class="popup-txt" style="color: var(--color-1)">Modifica i tuoi Film</span>
            </div>
            <br>
            <div>
                <%= form_with model: @user, url: profile_path, method: :patch, local: true, html: { multipart: true } do |f| %>
                    <div>
                        <%= f.label :first_film_title, "Film #1", style:"color: var(--color-1)" %><br>
                        <%= f.text_field :first_film_title, required: false, class: "form-control mb-3", style:"color: var(--color-1)" %>
                    </div>
                    <div>
                        <%= f.label :second_film_title, "Film #2", style:"color: var(--color-1)" %><br>
                        <%= f.text_field :second_film_title, required: false, class: "form-control mb-3", style:"color: var(--color-1)" %>
                    </div>
                    <div>
                        <%= f.label :third_film_title, "Film #3", style:"color: var(--color-1)" %><br>
                        <%= f.text_field :third_film_title, required: false, class: "form-control mb-3", style:"color: var(--color-1)" %>
                    </div>
                    <div>
                        <br>
                        <%= f.submit "Salva modifiche", class:"close-popup yellow-button button-1 submit-button" %>
                    </div>
                <% end %>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelector(".edit-button").addEventListener("click", function () {
              document.getElementById("edit-popup-overlay").style.display = "flex";
            });
            
            document.querySelector(".favourite-button").addEventListener("click", function () {
              document.getElementById("favourite-popup-overlay").style.display = "flex";
            });
            
            document.querySelectorAll(".close-popup").forEach(button => {
              button.addEventListener("click", function () {
                document.getElementById("edit-popup-overlay").style.display = "none";
                document.getElementById("favourite-popup-overlay").style.display = "none";
              });
            });
        });
    </script> 

</body>
